<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>11. Reading and Writing JSON Files - Android Programming</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "11. Reading and Writing JSON Files";
        var mkdocs_page_input_path = "2. Android/11-json.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Android Programming
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Android Programming</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">1. Kotlin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../1.%20Kotlin/01-kotlin/">The Kotlin Programming Language</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../1.%20Kotlin/02-kotlin-android/">Kotlin for Android</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">2. Android</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../01-intro/">1. Introduction to Mobile and Android Programming</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../02-intro-compose/">2. Introduction to Jetpack Compose</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../03-premi%C3%A8re-app/">3. First Application with Jetpack Compose</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../04-hockey-v1/">4. Hockey Application Version 1</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../05-etats-evenements/">5. State and Event Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../06-hockey-v2/">6. Hockey Application Version 2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../07-orientation/">7. Screen Orientation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../08-hockey-v3/">8. Hockey Application Version 3</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../09-etats-evenements-v2/">9. State and Event Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../10-localisation/">10. Localization</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">11. Reading and Writing JSON Files</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#saving-and-reading-json-data-in-kotlin">Saving and Reading JSON Data in Kotlin</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-1-preparation">Step 1: Preparation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-2-saving-data-to-a-json-file">Step 2: Saving Data to a JSON File</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-3-reading-data-from-a-json-file">Step 3: Reading Data from a JSON File</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-4-using-the-functions">Step 4: Using the Functions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#important-points">Important Points</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#file-management-in-android">File Management in Android</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#overwriting-and-creating-files">Overwriting and Creating Files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#file-location">File Location</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#best-practices-for-android-applications">Best Practices for Android Applications</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#using-application-context">Using Application Context</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#error-handling">Error Handling</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#checking-file-existence">Checking File Existence</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../12-cycle-de-vie/">12. Lifecycle and Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../13-architecture/">13. Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../14-navigation/">14. Navigation in Jetpack Compose</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../15-intentions/">15. Intents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../16-intentions-vs-navigation/">16. Intents vs. Navigation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../17-images-distantes/">17. Displaying Remote Images and Videos</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Android Programming</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">2. Android</li>
      <li class="breadcrumb-item active">11. Reading and Writing JSON Files</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="11-reading-and-writing-json-files">11. Reading and Writing JSON Files</h1>
<h2 id="saving-and-reading-json-data-in-kotlin">Saving and Reading JSON Data in Kotlin</h2>
<h3 id="step-1-preparation">Step 1: Preparation</h3>
<p>For example, the <code>Player</code> class is defined as follows:</p>
<pre><code class="language-kotlin">data class Player(
    val id: Int,
    val number: Int,
    val name: String,
    val image_resource: Int = R.drawable.nhl_logo
)
</code></pre>
<p>We'll use the <code>Gson</code> library for JSON serialization and deserialization. Add the following dependency in the module's
<code>build.gradle</code> file directly in the dependencies section of the <code>app/build.gradle.kts</code> file:</p>
<pre><code class="language-kotlin">implementation(&quot;com.google.code.gson:gson:2.10.1&quot;)
</code></pre>
<p>Another option offered by Android Studio is to convert this dependency to the Version Catalogs format. You can accept
this format change. The line above will be replaced by:</p>
<pre><code class="language-kotlin">implementation(libs.gson)
</code></pre>
<p>And two lines will be added to <code>gradle/libs.versions.toml</code> for <code>gson</code>:</p>
<pre><code class="language-toml">[versions]
gson = &quot;2.10.1&quot;

[libraries]
gson = { module = &quot;com.google.code.gson:gson&quot;, version.ref = &quot;gson&quot; }
</code></pre>
<h3 id="step-2-saving-data-to-a-json-file">Step 2: Saving Data to a JSON File</h3>
<p>To save a list of <code>Player</code> to a JSON file, we'll create an extension function:</p>
<pre><code class="language-kotlin">import com.google.gson.Gson
import java.io.File

fun List&lt;Player&gt;.saveToFile(filename: String) {
    val jsonString = Gson().toJson(this)
    File(filename).writeText(jsonString)
}
</code></pre>
<p>This function converts the list of <code>Player</code> to a JSON string, then writes it to a file.</p>
<h3 id="step-3-reading-data-from-a-json-file">Step 3: Reading Data from a JSON File</h3>
<p>To read the list of <code>Player</code> from a JSON file, we'll create another function:</p>
<pre><code class="language-kotlin">import com.google.gson.Gson
import com.google.gson.reflect.TypeToken
import java.io.File

fun readPlayersFromFile(filename: String): List&lt;Player&gt; {
    val jsonString = File(filename).readText()
    val playerListType = object : TypeToken&lt;List&lt;Player&gt;&gt;() {}.type
    return Gson().fromJson(jsonString, playerListType)
}
</code></pre>
<p>This function reads the content of the JSON file, then converts it to a list of <code>Player</code>.</p>
<h3 id="step-4-using-the-functions">Step 4: Using the Functions</h3>
<p>Here's an example of using these functions:</p>
<pre><code class="language-kotlin">fun main() {
    // Creating a list of players
    val players = listOf(
        Player(1, 99, &quot;Wayne Gretzky&quot;),
        Player(2, 87, &quot;Sidney Crosby&quot;),
        Player(3, 9, &quot;Bobby Orr&quot;)
    )

    // Saving players to a JSON file
    players.saveToFile(&quot;players.json&quot;)
    println(&quot;Players saved to players.json&quot;)

    // Reading players from the JSON file
    val loadedPlayers = readPlayersFromFile(&quot;players.json&quot;)
    println(&quot;Players loaded from players.json:&quot;)
    loadedPlayers.forEach { println(it) }
}
</code></pre>
<h3 id="important-points">Important Points</h3>
<ol>
<li><strong>Serialization</strong>: This is the process of converting objects to JSON format.</li>
<li><strong>Deserialization</strong>: This is the reverse process, converting JSON to Kotlin objects.</li>
<li><strong>File Management</strong>: Kotlin offers simple methods for reading and writing files.</li>
<li><strong>Gson Library</strong>: It greatly simplifies working with JSON in Kotlin.</li>
<li><strong>Data Class</strong>: Using <code>data class</code> for Player facilitates serialization/deserialization.</li>
</ol>
<h2 id="file-management-in-android">File Management in Android</h2>
<h3 id="overwriting-and-creating-files">Overwriting and Creating Files</h3>
<ol>
<li>
<p><strong>Overwriting Existing File</strong>
   When using the <code>File(filename).writeText(jsonString)</code> method, if the specified file already exists, its content will
   be effectively overwritten. This operation completely replaces the previous content with new data.</p>
</li>
<li>
<p><strong>Creating a New File</strong>
   If the specified file doesn't exist, Android will automatically create it before writing the data. This means you
   don't need to check for the file's existence or create it manually.</p>
</li>
</ol>
<h3 id="file-location">File Location</h3>
<p>The file location depends on the path you specify in the <code>filename</code> parameter. In the context of an Android application,
it's crucial to understand the different storage options:</p>
<ol>
<li>
<p><strong>Internal Storage</strong></p>
<ul>
<li>By default, if you use a relative path, the file will be created in your application's private directory.</li>
<li>Typical path: <code>/data/data/[your_app_package_name]/files/</code></li>
<li>This directory is private and accessible only by your application.</li>
</ul>
</li>
<li>
<p><strong>External Storage</strong></p>
<ul>
<li>To write to external storage (like SD card), you must request appropriate permissions and use an absolute path (
  see another section).</li>
<li>Example: <code>Environment.getExternalStorageDirectory().absolutePath + "/MyFolder/myfile.json"</code></li>
</ul>
</li>
</ol>
<h3 id="best-practices-for-android-applications">Best Practices for Android Applications</h3>
<h4 id="using-application-context">Using Application Context</h4>
<p>For better file management in an Android application, it's recommended to use the application context to get the
appropriate directory:</p>
<pre><code class="language-kotlin">fun Context.saveToFile(players: List&lt;Player&gt;, filename: String) {
    val file = File(this.filesDir, filename)
    file.writeText(Gson().toJson(players))
}

fun Context.readPlayersFromFile(filename: String): List&lt;Player&gt; {
    val file = File(this.filesDir, filename)
    val jsonString = file.readText()
    val playerListType = object : TypeToken&lt;List&lt;Player&gt;&gt;() {}.type
    return Gson().fromJson(jsonString, playerListType)
}
</code></pre>
<h4 id="error-handling">Error Handling</h4>
<p>It's important to add error handling to handle cases where writing or reading might fail:</p>
<pre><code class="language-kotlin">fun Context.saveToFile(players: List&lt;Player&gt;, filename: String) {
    try {
        val file = File(this.filesDir, filename)
        file.writeText(Gson().toJson(players))
    } catch (e: Exception) {
        Log.e(&quot;FileIO&quot;, &quot;Error writing file&quot;, e)
    }
}
</code></pre>
<h4 id="checking-file-existence">Checking File Existence</h4>
<p>Before reading a file, it's wise to check its existence:</p>
<pre><code class="language-kotlin">fun Context.readPlayersFromFile(filename: String): List&lt;Player&gt;? {
    val file = File(this.filesDir, filename)
    return if (file.exists()) {
        try {
            val jsonString = file.readText()
            val playerListType = object : TypeToken&lt;List&lt;Player&gt;&gt;() {}.type
            Gson().fromJson(jsonString, playerListType)
        } catch (e: Exception) {
            Log.e(&quot;FileIO&quot;, &quot;Error reading file&quot;, e)
            emptyList()
        }
    } else {
        emptyList()
    }
}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../10-localisation/" class="btn btn-neutral float-left" title="10. Localization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../12-cycle-de-vie/" class="btn btn-neutral float-right" title="12. Lifecycle and Architecture">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../10-localisation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../12-cycle-de-vie/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
